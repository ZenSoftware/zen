@if(!completed) {
  <form @verticalAccordion [formGroup]="form" (ngSubmit)="onSubmit()">
    @if(loading) {
      <zen-loading/>
    }
  
    <div class="mb-2">
      <zen-password-input #oldPasswordInput [formControl]="oldPassword" label="Current password" required/>
    </div>
  
    <mat-form-field hideRequiredMarker class="w-100 mb-2">
      <mat-label>{{'NEW_PASSWORD' | translate}}</mat-label>
      <input matInput autocomplete="new-password" [type]="hidePassword ? 'password' : 'text'" [formControl]="newPassword">
      <button type="button" mat-icon-button matSuffix (click)="hidePassword = !hidePassword" tabindex="-1" title="Toggle show password">
        <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
      </button>

      @if(newPassword.hasError('required')) {
        <mat-error>{{'REQUIRED' | translate}}</mat-error>
      }

      @if(newPassword.hasError('minlength')) {
        <mat-error>{{'MIN_LENGTH_ERROR' | translate:newPassword.getError('minlength')}}</mat-error>
      }

      @if(newPassword.hasError('maxlength')) {
        <mat-error>{{'MAX_LENGTH_ERROR' | translate:newPassword.getError('maxlength')}}</mat-error>
      }

      @if(newPassword.hasError('oldEqualsNew')) {
        <mat-error>{{'NEW_PASSWORD_MUST_EQUAL' | translate}}</mat-error>
      }
    </mat-form-field>
  
    <mat-form-field hideRequiredMarker class="w-100 mb-2">
      <mat-label>{{'CONFIRM_NEW_PASSWORD' | translate}}</mat-label>
      <input matInput autocomplete="new-password" [type]="hidePassword ? 'password' : 'text'" [formControl]="passwordConfirm">
      <button type="button" mat-icon-button matSuffix (click)="hidePassword = !hidePassword" tabindex="-1" title="Toggle show password">
        <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
      </button>

      @if(passwordConfirm.hasError('required')) {
        <mat-error>{{'REQUIRED' | translate}}</mat-error>
      }

      @if(passwordConfirm.hasError('notMatching')) {
        <mat-error>{{'PASSWORD_DOES_NOT_MATCH' | translate}}</mat-error>
      }
    </mat-form-field>
  
    <button type="submit" mat-raised-button color="primary" class="w-100 fs-4 py-1" [disabled]="!form.valid">
      <i class="fa-solid fa-fw fa-cloud-upload-alt me-1"></i>
      {{'SUBMIT' | translate}}
    </button>
  </form>
}

@if(generalError) {
  <div @verticalAccordion class="card">
    <div class="card-body">
      <div class="mb-4">
        <mat-error>
          <div class="text-center mb-2">
            <div>
              <i class="fa-solid fa-exclamation-triangle fa-4x mb-4"></i>
            </div>
  
            {{'PASSWORD_CHANGE_PROBLEM' | translate}}
            <i class="fa fa-stopwatch"></i>
          </div>
        </mat-error>
      </div>
  
      <button mat-stroked-button color="primary" routerLink="/password-reset-request" class="w-100 fs-4">
        <i class="fa-solid fa-redo me-2"></i>
        {{'CLICK_HERE_TO_REQUEST' | translate}}
      </button>
    </div>
  </div>
}

@if(completed) {
  <div @verticalAccordion>
    <div class="card mb-2">
      <div class="card-body text-center">
        <i class="fa-solid fa-save fa-5x text-info mb-3"></i>
        <h3>{{'PASSWORD_SUCCESSFULLY_CHANGED' | translate}}</h3>

        <button mat-stroked-button color="primary" (click)="changeAgain()" class="w-100 fs-4 mb-3">
          <i class="fa-solid fa-redo me-2"></i>
          {{'CHANGE_AGAIN' | translate}}
        </button>
      </div>
    </div>
  </div>
}